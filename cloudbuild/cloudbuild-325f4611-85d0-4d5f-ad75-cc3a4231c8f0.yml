steps:
  - name: gcr.io/cloud-builders/docker
    args:
      - build
      - '--build-arg'
      - TAG_NAME=$SHORT_SHA
      - '-t'
      - gcr.io/platformer-november/golang-rest-api:$SHORT_SHA
      - '-f'
      - Dockerfile
      - .
  - name: gcr.io/cloud-builders/curl
    entrypoint: curl
    args:
      - '--header'
      - 'x-organization-id: a0bc5879-eade-4204-8958-5264f2b243b1'
      - '--header'
      - 'x-project-id: fe1e53b1-d0f7-4786-b1de-4a41b90ac3dc'
      - '-d'
      - '{ "channel": "default",  "update_type": "patch", "container_id": "e1253401-e971-4bd5-a646-b6b6010fe8d3",  "image_name_with_tag": "gcr.io/platformer-november/golang-rest-api:$SHORT_SHA"}'
      - '-X'
      - POST
      - https://beta.api.platformer.com/rudder/webhook/v1/container?token=${_PLATFORMER_AUTOGENERATED_CICD}
images:
  - gcr.io/platformer-november/golang-rest-api:$SHORT_SHA
